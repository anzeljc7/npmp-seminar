<?xml version="1.0" encoding="UTF-8"?>
<sbml xmlns="http://www.sbml.org/sbml/level3/version1/core" level="3" version="1">
  <model id="CoherentFeedForwardLoop_AND_Gate" name="ShenOrr2002_CFFL_PulseFilter">
    <notes>
      <body xmlns="http://www.w3.org/1999/xhtml">
        <p>
          Model of the Coherent Feedforward Loop (CFFL) with AND-gate logic, based on 
          Shen-Orr et al. (2002) [Nature Genetics 31:64-68].
        </p>
        <p>
          Logic: X -> Y; (X AND Y) -> Z. 
          This structure functions as a persistence detector, rejecting transient pulses of X 
          (noise) while responding to persistent signals.
        </p>
      </body>
    </notes>

    <listOfFunctionDefinitions>
      <functionDefinition id="stepFunction">
        <math xmlns="http://www.w3.org/1998/Math/MathML">
          <lambda>
            <bvar><ci> signal </ci></bvar>
            <bvar><ci> threshold </ci></bvar>
            <piecewise>
              <piece>
                <cn type="integer"> 1 </cn>
                <apply>
                  <geq/>
                  <ci> signal </ci>
                  <ci> threshold </ci>
                </apply>
              </piece>
              <otherwise>
                <cn type="integer"> 0 </cn>
              </otherwise>
            </piecewise>
          </lambda>
        </math>
      </functionDefinition>
    </listOfFunctionDefinitions>

    <listOfCompartments>
      <compartment id="cell" size="1" spatialDimensions="3" constant="true"/>
    </listOfCompartments>

    <listOfSpecies>
      <species id="X" compartment="cell" initialConcentration="0" hasOnlySubstanceUnits="false" boundaryCondition="true" constant="false"/>
      <species id="Y" compartment="cell" initialConcentration="0" hasOnlySubstanceUnits="false" boundaryCondition="false" constant="false"/>
      <species id="Z" compartment="cell" initialConcentration="0" hasOnlySubstanceUnits="false" boundaryCondition="false" constant="false"/>
    </listOfSpecies>

    <listOfParameters>
      <parameter id="T_xy" value="0.5" constant="true"/>  <parameter id="T_xz" value="0.5" constant="true"/>  <parameter id="T_yz" value="0.5" constant="true"/>  <parameter id="beta_y" value="1.0" constant="true"/> <parameter id="beta_z" value="1.0" constant="true"/> <parameter id="alpha"  value="1.0" constant="true"/> </listOfParameters>

    <listOfReactions>
      
      <reaction id="Synthesis_Y" reversible="false" fast="false">
        <listOfProducts>
          <speciesReference species="Y" stoichiometry="1" constant="true"/>
        </listOfProducts>
        <kineticLaw>
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <times/>
              <ci> beta_y </ci>
              <apply>
                <ci> stepFunction </ci>
                <ci> X </ci>
                <ci> T_xy </ci>
              </apply>
            </apply>
          </math>
        </kineticLaw>
      </reaction>

      <reaction id="Degradation_Y" reversible="false" fast="false">
        <listOfReactants>
          <speciesReference species="Y" stoichiometry="1" constant="true"/>
        </listOfReactants>
        <kineticLaw>
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <times/>
              <ci> alpha </ci>
              <ci> Y </ci>
            </apply>
          </math>
        </kineticLaw>
      </reaction>

      <reaction id="Synthesis_Z" reversible="false" fast="false">
        <listOfProducts>
          <speciesReference species="Z" stoichiometry="1" constant="true"/>
        </listOfProducts>
        <kineticLaw>
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <times/>
              <ci> beta_z </ci>
              <apply>
                <times/>
                <apply>
                  <ci> stepFunction </ci>
                  <ci> X </ci>
                  <ci> T_xz </ci>
                </apply>
                <apply>
                  <ci> stepFunction </ci>
                  <ci> Y </ci>
                  <ci> T_yz </ci>
                </apply>
              </apply>
            </apply>
          </math>
        </kineticLaw>
      </reaction>

      <reaction id="Degradation_Z" reversible="false" fast="false">
        <listOfReactants>
          <speciesReference species="Z" stoichiometry="1" constant="true"/>
        </listOfReactants>
        <kineticLaw>
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <times/>
              <ci> alpha </ci>
              <ci> Z </ci>
            </apply>
          </math>
        </kineticLaw>
      </reaction>
    </listOfReactions>

    <listOfEvents>
      <event id="Pulse1_On" useValuesFromTriggerTime="true">
        <trigger initialValue="false" persistent="true">
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <geq/>
              <csymbol encoding="text" definitionURL="http://www.sbml.org/sbml/symbols/time"> time </csymbol>
              <cn type="integer"> 2 </cn>
            </apply>
          </math>
        </trigger>
        <listOfEventAssignments>
          <eventAssignment variable="X">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
              <cn type="integer"> 1 </cn>
            </math>
          </eventAssignment>
        </listOfEventAssignments>
      </event>

      <event id="Pulse1_Off" useValuesFromTriggerTime="true">
        <trigger initialValue="false" persistent="true">
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <geq/>
              <csymbol encoding="text" definitionURL="http://www.sbml.org/sbml/symbols/time"> time </csymbol>
              <cn type="real"> 2.4 </cn>
            </apply>
          </math>
        </trigger>
        <listOfEventAssignments>
          <eventAssignment variable="X">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
              <cn type="integer"> 0 </cn>
            </math>
          </eventAssignment>
        </listOfEventAssignments>
      </event>

      <event id="Pulse2_On" useValuesFromTriggerTime="true">
        <trigger initialValue="false" persistent="true">
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <geq/>
              <csymbol encoding="text" definitionURL="http://www.sbml.org/sbml/symbols/time"> time </csymbol>
              <cn type="integer"> 10 </cn>
            </apply>
          </math>
        </trigger>
        <listOfEventAssignments>
          <eventAssignment variable="X">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
              <cn type="integer"> 1 </cn>
            </math>
          </eventAssignment>
        </listOfEventAssignments>
      </event>

      <event id="Pulse2_Off" useValuesFromTriggerTime="true">
        <trigger initialValue="false" persistent="true">
          <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
              <geq/>
              <csymbol encoding="text" definitionURL="http://www.sbml.org/sbml/symbols/time"> time </csymbol>
              <cn type="integer"> 20 </cn>
            </apply>
          </math>
        </trigger>
        <listOfEventAssignments>
          <eventAssignment variable="X">
            <math xmlns="http://www.w3.org/1998/Math/MathML">
              <cn type="integer"> 0 </cn>
            </math>
          </eventAssignment>
        </listOfEventAssignments>
      </event>
    </listOfEvents>
  </model>
</sbml>